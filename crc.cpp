#include <stdio.h>
#include <string.h>
#include <fstream>
#include <iostream>
using namespace std;

std::string crc64_pair(char* data)
{
    int crc_count = 4096;
    int shr, tmp_1h, tmp_1l, table_i, crc_h, crc_l;
    char crc_format_arr[32];

    int CRC_TABLE_H[256] = {0};
    int CRC_TABLE_L[] = {0,27,54,45,108,119,90,65,216,195,238,245,180,175,130,153,432,427,390,413,476,455,490,497,360,371,350,325,260,287,306,297,864,891,854,845,780,791,826,801,952,931,910,917,980,975,994,1017,720,715,742,765,700,679,650,657,520,531,574,549,612,639,594,585,1728,1755,1782,1773,1708,1719,1690,1665,1560,1539,1582,1589,1652,1647,1602,1625,1904,1899,1862,1885,1820,1799,1834,1841,1960,1971,1950,1925,1988,2015,2034,2025,1440,1467,1430,1421,1484,1495,1530,1505,1400,1379,1358,1365,1300,1295,1314,1337,1040,1035,1062,1085,1148,1127,1098,1105,1224,1235,1278,1253,1188,1215,1170,1161,3456,3483,3510,3501,3564,3575,3546,3521,3416,3395,3438,3445,3380,3375,3330,3353,3120,3115,3078,3101,3164,3143,3178,3185,3304,3315,3294,3269,3204,3231,3250,3241,3808,3835,3798,3789,3724,3735,3770,3745,3640,3619,3598,3605,3668,3663,3682,3705,3920,3915,3942,3965,3900,3879,3850,3857,3976,3987,4030,4005,4068,4095,4050,4041,2880,2907,2934,2925,2860,2871,2842,2817,2968,2947,2990,2997,3060,3055,3010,3033,2800,2795,2758,2781,2716,2695,2730,2737,2600,2611,2590,2565,2628,2655,2674,2665,2080,2107,2070,2061,2124,2135,2170,2145,2296,2275,2254,2261,2196,2191,2210,2233,2448,2443,2470,2493,2556,2535,2506,2513,2376,2387,2430,2405,2340,2367,2322,2313};

    crc_h = 0xFFFFFFFF; 
    crc_l = 0xFFFFFFFF;

    for (int j = 0; j < crc_count; ++j)
    {
        shr = (crc_l >> 24) & 0xFF;
        tmp_1h = (crc_h << 8) | shr;
        tmp_1h = tmp_1h & 0xFFFFFFFF;
        tmp_1l = (crc_l << 8);
        tmp_1l = tmp_1l & 0xFFFFFFFF;
        table_i = ((crc_h >> 24) ^ data[j]) & 0xFF;
        crc_h = tmp_1h ^ CRC_TABLE_H[table_i];
        crc_l = tmp_1l ^ CRC_TABLE_L[table_i];
    }

    snprintf(crc_format_arr, sizeof(crc_format_arr), "%08X%08X", crc_h, crc_l);
    std::string crc_format_str = crc_format_arr;

    return crc_format_str;
}

int main()
{   
    char data[4096];
    ifstream infile;
    infile.open("126_20200701_113333.wav"); 
    infile.read(data, 4096);
    infile.close();

    std::string crc_f_str = crc64_pair(data);
    cout << crc_f_str << endl;
    return 0;
}
